version: "3.8"

networks:
  twiposter-network:
    name: twiposter-network
    driver: bridge

services:
    api:
        container_name: twitposter-api
        build:
          context: .
          dockerfile: Dockerfile
        restart: always
        ports:
          - "8089:80"
        depends_on:
          - mssqlDb
          - seq
        networks:
          - twiposter-network
        deploy:
          resources:
              limits:
                cpus: "6"
                memory: 1g

    mssqlDb:
        container_name: twitposter-mssql
        image: "mcr.microsoft.com/mssql/server:2022-latest"
        ports:
          - "1433:1433"
        networks: 
         - twiposter-network
        environment:
            SA_PASSWORD: "2Secure*Password2"
            ACCEPT_EULA: "Y"
        volumes:
        - twitposter-database:/var/opt/mssql
        deploy:
          resources:
              limits:
                cpus: "6"
                memory: 2g
    seq:
        image: datalust/seq:latest
        container_name: twitposter-seq
        restart: unless-stopped
        environment:
          - ACCEPT_EULA=Y
        ports:
          - "81:80"
          - "5341:5341"
        volumes:
          - seq-logs:/seqdata
        networks:
        - twiposter-network
        deploy:
          resources:
              limits:
                cpus: "0.50"
                memory: 512M

    seq-gelf:
      image: datalust/seq-input-gelf:latest
      container_name: twitposter-seq-gelf
      restart: unless-stopped
      environment:
        - ACCEPT_EULAY=Y
        - SEQ_ADDRESS=http://seq:5341
      depends_on:
        - seq
      ports:
        - "12201:12201/udp"
      networks:
        - twiposter-network
      deploy:
        resources:
            limits:
              cpus: "0.50"
              memory: 512M
    

volumes:
  twitposter-database:
  seq-logs: